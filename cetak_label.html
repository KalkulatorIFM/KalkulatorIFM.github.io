<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=0.9, shrink-to-fit=no" />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
      integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />

    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link
      rel="stylesheet"
      href="https://printjs-4de6.kxcdn.com/print.min.csshttps://printjs-4de6.kxcdn.com/print.min.css" />
    <script src="https://printjs-4de6.kxcdn.com/print.min.js"></script>

    <link rel="stylesheet" href="css/custome.css" />

    <style type="text/css">
      @media print {
        .pagebreak {
          page-break-before: always;
        } /* page-break-after works, as well */
      }
    </style>

    <title>Kalkulator-IFM</title>
  </head>

  <body style="background-color: #ececec !important">
    <div class="row justify-content-center p-3">
      <div class="col-lg-12">
        <h4 class="text-center my-3">~ Cetak Label ~</h4>
      </div>
      <div class="col-lg-6 col-md-12">
        <form>
          <div class="form-group">
            <label>Nama Penerima :</label>
            <input
              type="text"
              class="form-control"
              name="nama_penerima"
              placeholder="Nama Penerima" />
          </div>

          <div class="form-group">
            <label>Tanggal :</label>
            <input
              type="date"
              class="form-control"
              name="tanggal"
              placeholder="Tanggal" />
          </div>

          <div class="form-group">
            <label>Nomor Batch :</label>
            <input
              type="text"
              class="form-control"
              name="no_batch"
              placeholder="Nomor Batch"
              oninput="this.value = this.value.toUpperCase()" />
          </div>

          <div class="form-group">
            <label for="produk">Produk :</label>
            <select class="form-control select2" name="produk">
              <option value="" selected disabled></option>
              <optgroup label="Chiki Ball">
                <option value="40" data-produk="CBL CHE 16">CBL CHE 16</option>
                <option value="24" data-produk="CBL CHE 55">CBL CHE 55</option>
                <option value="24" data-produk="CBL CHE 200">
                  CBL CHE 200
                </option>
                <option value="40" data-produk="CBL CHO 16">CBL CHO 16</option>
                <option value="24" data-produk="CBL CHO 55">CBL CHO 55</option>
                <option value="24" data-produk="CBL CHO 200">
                  CBL CHO 200
                </option>
                <option value="40" data-produk="CBL CHN 16">CBL CHN 16</option>
                <option value="24" data-produk="CBL CHN 55">CBL CHN 55</option>
                <option value="24" data-produk="CBL CHN 200">
                  CBL CHN 200
                </option>
              </optgroup>
              <optgroup label="Promina">
                <option value="54" data-produk="PRP Crunch 10">
                  PRP Crunch 10
                </option>
                <option value="120" data-produk="PRP STA 15">PRP STA 15</option>
                <option value="120" data-produk="PRP BLUE 15">
                  PRP BLUE 15
                </option>
                <option value="120" data-produk="PRP BNN 15">PRP BNN 15</option>
                <option value="120" data-produk="PRP PEACH 15">
                  PRP PEACH 15
                </option>
              </optgroup>
              <optgroup label="Chiki Twist">
                <option value="40" data-produk="CTW ROC 23">CTW ROC 23</option>
                <option value="42" data-produk="CTW ROC 40">CTW ROC 40</option>
                <option value="24" data-produk="CTW ROC 75">CTW ROC 75</option>
                <option value="42" data-produk="CTW CHG 40">CTW CHG 40</option>
                <option value="24" data-produk="CTW CHG 75">CTW CHG 75</option>
              </optgroup>
              <optgroup label="Maxicorn">
                <option value="40" data-produk="MAX ROC 20">MAX ROC 20</option>
                <option value="24" data-produk="MAX ROC 55">MAX ROC 55</option>
                <option value="24" data-produk="MAX ROC 150">
                  MAX ROC 150
                </option>
                <option value="24" data-produk="MAX BBQ 55">MAX BBQ 55</option>
                <option value="24" data-produk="MAX BBQ 150">
                  MAX BBQ 150
                </option>
                <option value="24" data-produk="MAX NAC 150">
                  MAX NAC 150
                </option>
              </optgroup>
              <optgroup label="Chitato Lite">
                <option value="40" data-produk="CTL NOS 14">CTL NOS 14</option>
                <option value="40" data-produk="CTL NOS 18">CTL NOS 18</option>
                <option value="30" data-produk="CTL NOS 35">CTL NOS 35</option>
                <option value="24" data-produk="CTL NOS 68">CTL NOS 68</option>
                <option value="24" data-produk="CTL NOS 120">
                  CTL NOS 120
                </option>
                <option value="30" data-produk="CTL NOS 168">
                  CTL NOS 168
                </option>
                <option value="24" data-produk="CTL BBQ 68">CTL BBQ 68</option>
                <option value="24" data-produk="CTL SAT 68">CTL SAT 68</option>
              </optgroup>
              <optgroup label="Chitato">
                <option value="40" data-produk="CTT BEB 15">CTT BEB 15</option>
                <option value="40" data-produk="CTT BEB 19">CTT BEB 19</option>
                <option value="30" data-produk="CTT BEB 35">CTT BEB 35</option>
                <option value="32" data-produk="CTT BEB 55">CTT BEB 55</option>
                <option value="24" data-produk="CTT BEB 68">CTT BEB 68</option>
                <option value="24" data-produk="CTT BEB 120">
                  CTT BEB 120
                </option>
                <option value="30" data-produk="CTT BEB 168">
                  CTT BEB 168
                </option>
                <option value="30" data-produk="CTT SPC 35">CTT SPC 35</option>
                <option value="24" data-produk="CTT SPC 68">CTT SPC 68</option>
                <option value="30" data-produk="CTT SPC 168">
                  CTT SPC 168
                </option>
                <option value="30" data-produk="CTT SGB 35">CTT SGB 35</option>
                <option value="24" data-produk="CTT SGB 68">CTT SGB 68</option>
                <option value="24" data-produk="CTT CHB 68">CTT CHB 68</option>
                <option value="24" data-produk="CTT CHS 68">CTT CHS 68</option>
                <option value="24" data-produk="CTT FRN 68">CTT FRN 68</option>
                <option value="24" data-produk="CTT PLS 68">CTT PLS 68</option>
                <option value="24" data-produk="CTT SCO 68">CTT SCO 68</option>
                <option value="24" data-produk="CTT MAX CMC 68">
                  CTT MAX CMC 68
                </option>
              </optgroup>
            </select>
          </div>

          <div class="form-group">
            <label>Jumlah CAR :</label>
            <input
              type="text"
              autocomplete="off"
              class="form-control"
              name="jumlah"
              placeholder="" />
          </div>

          <div class="form-group">
            <label>BIN Location :</label>
            <input
              type="text"
              autocomplete="off"
              class="form-control"
              name="bin"
              placeholder="Example : A ,  A - B" />
          </div>

          <button
            type="reset"
            class="btn btn-secondary btn-block btn-lg mt-4 mb-4"
            id="btn-reset">
            Reset
          </button>
        </form>

        <div class="card mt-4">
          <div class="card-header text-center">Output</div>
          <div class="card-body text-center">
            <h4 id="text-info"></h4>
          </div>
        </div>
        <button
          type="button"
          class="btn btn-primary btn-block btn-lg mt-4"
          id="btn-print"
          style="display: none !important">
          Print Label <i class="fas fa-print"></i>
        </button>

        <br />
        <br />
        <ul>
          <li>
            <a href="index.html" class="text-center"
              >Halaman Convert CAR ke Palet</a
            >
          </li>
          <li>
            <a href="index1.html" class="text-center"
              >Halaman Convert Palet ke CAR</a
            >
          </li>
          <li>
            <a href="simulation_tier.html" class="text-center"
              >Halaman Simulasi Tier Muat</a
            >
          </li>
        </ul>
      </div>

      <div class="demo"></div>
    </div>

    <div class="modal" style="width: 100℅ !important;">
      <div class="modal-dialog" style="width: 100℅ !important;">
        <div class="modal-content" style="width: 100℅ !important;">
          <div class="modal-body" id="content-print" style="width: 100℅ !important;"></div>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"></script>
    <!-- select 2 -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"
      integrity="sha512-2ImtlRlf2VVmiGZsjm9bEyhjGW4dU7B6TNwh/hx/iSByxNENtj3WVE6o/9Lj4TJeVXPi4bnOIMXFIJJAeufa0A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"></script>
    <!-- qr code -->
    <script type="text/javascript" src="./assets/js/qr-code.js"></script>
    <script>
      function formatOutput(optionElement) {
        if (!optionElement.id) {
          return optionElement.text;
        }
        var $state = $(
          "<span>" +
            optionElement.text +
            '<small style="float: right; margin-top: 7px; color: #d0d0d0;">' +
            optionElement.element.value +
            "</small></span>"
        );
        return $state;
      }

      $(document).ready(function () {
        $(".select2").select2({
          placeholder: "-- Pilih Produk --",
          templateResult: formatOutput,
        });

        $('[name="produk"]').change(function () {
          // loadData();
          $('[name="jumlah"]').val("");
          $('[name="cut_off"]').val("");
          $('input[name="beda_gis[]"]').val("");
          $(".reset-beda-gis").remove();
          $("#text-info").html("");
        });

        $('[name="jumlah"]').keyup(function () {
          var result = parseInt($(this).val().replace(".", ""));
          if (result) {
            $(this).val(result.toLocaleString("ID"));
          } else {
            $(this).val("");
          }

          loader();

          _changeInterval = null;
          clearInterval(_changeInterval);
          _changeInterval = setInterval(function () {
            loadData();
            clearInterval(_changeInterval);
          }, 2500);
        });

        $("#btn-reset").click(function () {
          $('[name="produk"]').val("").trigger("change");
          $(".reset-beda-gis").remove();

          $("#text-info").html("");
        });

        function loader() {
          if ($('[name="produk"]').val()) {
            $("#text-info").html(`
                        <h4 class="fas fa-spinner fa-spin"></h4>
                    `);
          }
        }

        function loadData() {
          var produk = parseInt($('[name="produk"] option:selected').val());
          var nama_produk = $('[name="produk"] option:selected').data("produk");
          var jumlah = parseInt($('[name="jumlah"]').val().replace(".", ""));
          var nama_penerima = $('[name="nama_penerima"]').val();
          var no_batch = $('[name="no_batch"]').val();
          var tanggal = $('[name="tanggal"]').val();
          var bin = $('[name="bin"]').val();

          var date = new Date();
          var seconds = date.getSeconds();
          var minutes = date.getMinutes();
          var hour = date.getHours();

          if (!produk || !jumlah || !nama_penerima || !tanggal || !no_batch) {
            $("#text-info").html(`Data belum lengkap !`);
            $("#btn-print").hide();
          } else {
            var __CONTENT_LABEL_PRINT = ``;
            var text_1 =
              jumlah.toLocaleString("ID") +
              " CAR &nbsp; <i class='fa fa-exchange mr-2 ml-2' aria-hidden='true'></i> &nbsp; ";
            var text_2 = ``;

            if (produk > jumlah) {
              text_2 = jumlah + " CAR";
              __CONTENT_LABEL_PRINT = `
                        	<div style="width: 100% !important; max-width: !important;">
	                        	<div style="text-align: center; font-size: 8px; font-family: sans-serif;">
                              <h1 style="font-size: 24px;">${bin}</h1>
	                        		<p style="margin-top: -15px; margin-bottom: -5px;">${hour}${minutes}${seconds}${nama_produk.replaceAll(
                " ",
                "-"
              )}-1</p>
	                        		<p>LABEL FINISH GOOD <br> PT INDOFOOD FORTUNA MAKMUR</p>
	                        		<table width="100%" style="text-align:left;" cellpaddin="0" cellspacing="0">
	                        			<tr>
	                        				<td width="18%">Produk</td>
	                        				<td width="2%">:</td>
	                        				<td>${nama_produk}</td>

	                        				<td width="18%">Jumlah</td>
	                        				<td width="2%">:</td>
	                        				<td width="15%">${jumlah}</td>
	                        			</tr>
	                        			<tr>
	                        				<td width="18%">Diterima</td>
	                        				<td width="2%">:</td>
	                        				<td>${tanggal} &nbsp;-&nbsp; ${hour}:${minutes}:${seconds}</td>

	                        				<td width="18%">No Pallet</td>
	                        				<td width="2%">:</td>
	                        				<td width="15%">1</td>
	                        			</tr>
	                        			<tr>
	                        				<td width="18%">No Batch</td>
	                        				<td width="2%">:</td>
	                        				<td colspan="3">${no_batch}</td>
	                        			</tr>
	                        		</table>
	                        		<br>
	                        		<div class="qr-code" data-serial-number="${hour}${minutes}${seconds}${nama_produk.replace(
                " ",
                "-"
              )}-1"></div>
	                        		
	                        		<table width="100%" style="text-align:left;">
	                        			<tr>
	                        				<td colspan="2">Dibuat</td>
	                        			</tr>
	                        			<tr>
	                        				<td width="50%">
	                        					${nama_penerima}
	                        					<br>
	                        					(Checker)
	                        				</td>	
	                        				<td> 
	                        					nama kasie
	                        					<br>
	                        					(Kasie)
	                        				</td>
	                        			</tr>
	                        		</table>
	                        	</div>
	                        </div>
                        `;
            } else {
              var condition = true;
              var palet = 0;
              var akhiran = 0;
              while (condition) {
                jumlah -= produk;
                palet++;

                if (jumlah) {
                  text_2 = palet + " &nbsp;+&nbsp; " + jumlah;
                  akhiran = jumlah;
                } else {
                  text_2 = palet;
                }

                if (jumlah < produk) {
                  condition = false;

                  if (!jumlah) {
                    akhiran = 0;
                  }
                }
              }

              if (akhiran) {
                palet++;
              }
              for (var i = 1; i <= palet; i++) {
                var date = new Date();
                var seconds = date.getSeconds();
                var minutes = date.getMinutes();
                var hour = date.getHours();

                if (akhiran && i == palet) {
                  produk = akhiran;
                }

                __CONTENT_LABEL_PRINT += `
	                        	<div style="width: 210px; max-width: 230px;">
		                        	<div style="text-align: center; font-size: 8px; font-family: sans-serif;">
		                        		<h1 style="font-size: 24px;">${bin}</h1>
		                        		<p style="margin-top: -15px; margin-bottom: -5px;">${hour}${minutes}${seconds}${nama_produk.replaceAll(
                  " ",
                  "-"
                )}-${i}</p>
		                        		<p>LABEL FINISH GOOD <br> PT INDOFOOD FORTUNA MAKMUR</p>
		                        		<table width="100%" style="text-align:left;">
		                        			<tr>
		                        				<td width="18%">Produk</td>
		                        				<td width="2%">:</td>
		                        				<td>${nama_produk}</td>

		                        				<td width="18%">Jumlah</td>
		                        				<td width="2%">:</td>
		                        				<td width="15%">${produk}</td>
		                        			</tr>
		                        			<tr>
		                        				<td width="18%">Diterima</td>
		                        				<td width="2%">:</td>
		                        				<td>${tanggal} &nbsp;-&nbsp; ${hour}:${minutes}:${seconds}</td>

		                        				<td width="18%">No Pallet</td>
		                        				<td width="2%">:</td>
		                        				<td width="15%">${i}</td>
		                        			</tr>
		                        			<tr>
		                        				<td width="18%">No Batch</td>
		                        				<td width="2%">:</td>
		                        				<td colspan="3">${no_batch}</td>
		                        			</tr>
		                        		</table>
		                        		<br>
		                        		<div class="qr-code" data-serial-number="${hour}${minutes}${seconds}${nama_produk.replace(
                  " ",
                  "-"
                )}-${i}"></div>
		                        		
		                        		<table width="100%" style="text-align:left;">
		                        			<tr>
		                        				<td colspan="2">Dibuat</td>
		                        			</tr>
		                        			<tr>
		                        				<td width="50%">
		                        					${nama_penerima}
		                        					<br>
		                        					(Checker)
		                        				</td>	
		                        				<td> 
		                        					nama kasie
		                        					<br>
		                        					(Kasie)
		                        				</td>
		                        			</tr>
		                        		</table>
		                        	</div>
		                        </div>
	                        `;

                if (i != palet) {
                  __CONTENT_LABEL_PRINT += `<div style="page-break-before: always !important;"></div>`;
                }
              }
            }

            $("#content-print").html(__CONTENT_LABEL_PRINT);
            $("#content-print .qr-code").each(function (index, element, index) {
              $(element).qrcode({
                size: 100,
                fill: "#000",
                text: `${$(element).data("serial-number")}`,
                mode: 0,
              });
            });

            $("#text-info").html(text_1 + text_2);
            $("#btn-print").show();
          }
        }

        $("#btn-print").click(function () {
          $(this).html("Waiting..").attr("disabled");
          printJS({
            printable: "content-print", // the id
            type: "html",
            targetStyles: ["*"],
          });
          $(this)
            .html('Print Label <i class="fas fa-print"></i>')
            .removeAttr("disabled");
        });
      });
    </script>
  </body>
</html>
